### 延迟复制节点 

延迟复制成员也拥有副本集的数据，但是它拥有的是一段时间之前的数据。比如，现在是9:52，一个存在一小时延迟的延迟复制成员，拥有的数据时副本集在8:52分时的。

延迟成员作为一个数据后备或者说一个数据的历史快照，它可以帮助你从人为的误操作中恢复数据。如果误删除了一个数据库或者集合，或者应用升级失败，那么延迟节点可以帮助你恢复数据。

#### 注意
+ **要求** 
延迟节点
    - 必须是priority为0的成员。避免延迟节点成为主节点。
    - 必须是隐藏节点，这样可以避免客户端应用在延迟节点上查询数据。
    - 如果votes参数设置为1，那么在选举中可以参与投票。

+ **表现**
延迟节点以一定的延迟对oplog进行复制和应用。在选择延迟的时间时，需要考虑: 
    - 必须要大于等于你预期的一个维修窗口期。
    - 必须小于oplog的容量。(我的理解是，必须保证在延迟节点能够存储下在延迟的这段时间内产生的oplog。)

+ **写确认** ??(为啥延迟节点也可以来参与写的确认)
延迟节点也可以参与对写操作的确认，但是它必须同时是拥有投票权的节点。没有投票权的成员不能参与写操作的确认。

延迟节点不可能在配置的 slaveDelay 之前返回写确认。

+ **分片**
在分片集群中，因为负载均衡的存在延迟节点的作用是有限的。因为延迟节点复制chunk的迁移也是有延迟的，如果在延迟的窗口期内发生了任何chunk的迁移，那么就无法通过延迟节点来恢复数据。
(不理解，为啥发生了迁移就不好通过延迟节点恢复数据？)


+ **举例**
在下面的5成员副本集中，主节点和从节点都存有数据的拷贝。一个成员对于oplog的应用有1小时的延迟，该成员也是隐藏并且priority=0。

！[avatar](https://docs.mongodb.com/manual/_images/replica-set-delayed-member.bakedsvg.svg)

+ **配置**
延迟节点的 members[n].priority = 0 ，members[n].hidden  = true,members[n].slaveDelay = 3600s。

```
{
   "_id" : <num>,
   "host" : <hostname:port>,
   "priority" : 0,
   "slaveDelay" : <seconds>,
   "hidden" : true
}
```

