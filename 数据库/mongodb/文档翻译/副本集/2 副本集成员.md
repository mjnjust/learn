[TOC]
# 副本集成员   

mongdb的副本集就是一组能够提供冗余和高可用的mongd实例。其成员包括: 

+ 一个主节点
    主节点接受所有的写请求。
+ N个从节点
    从节点复制主节点的操作来保证和主节点数据的一致。从节点也有一些额外的配置可以使从节点作为特殊的用途。比如，主节点可以设置为无投票权或者无法成为主节点(priority=0)。

推荐的最小副本集配置是三个成员:一个主节点和两个从节点。在某些情况下(比如成本问题不允许你用两个从节点),你可以选择一个从节点加一个仲裁者节点。仲裁者节点可以选举都是不会持有数据(也就是说仲裁者节点不提供数据冗余)。

一个副本集可以拥有50个成员但是最多只能有7个成员具有投票权。(为什么呢，因为投票成员之间需要知道相互的存活状态，会有大量的信息交互，节点太多会导致无限制的信息交换)。

+ 主节点 

主节点是副本集中唯一可以接受写请求的节点。mongdb在主节点上执行写操作然后把这些操作记录到主节点的oplog中。从节点成员复制这些oplog然后在自己的数据集合上执行这些写操作。

在下面的3成员副本集中，主节点接受写请求，从节点赋值主节点的oplog并应用到自己的数据集合上。

![avatar](https://docs.mongodb.com/manual/_images/replica-set-read-write-operations-primary.bakedsvg.svg)

所有的成员都可以接受读请求。但是，默认情况下，应用会把读请求发往主节点。可以在读配置首选项中查看更多配置细节。

副本集最多只能有一个主节点。如果当前主节点不可用，那么会通过选举产生新的主节点。

+ Secondaries 从节点

从节点拥有主节点数据的拷贝。从节点通过异步的进程从主节点中拷贝oplog。一个副本集可以有一个或多个从节点。

在下面的3成员副本集中有两个从节点。从节点复制主节点的oplog然后把写操作应用到自己的数据集合上。

![avatar](https://docs.mongodb.com/manual/_images/replica-set-primary-with-two-secondaries.bakedsvg.svg)

虽然客户端不能再从节点上执行写操作，但是读操作仍然是允许的。

一个从节点可以成为主节点。如果当前的主节点不可用，集群会发起一次选举来选择一个从节点成为新的主节点。

你可以根据从节点的作用不同来配置从节点。比如可以将从节点用于:

+ 设置priority = 0。避免从节点被投票为主节点，这允许从节点只作为一个数据的冷备份。

+ 设置从节点为隐藏节点，禁止对外提供数据读取服务，这允许它可以为一些需要和正常流量分离的应用程序提供服务。

+ 设置为延迟复制节点。可以作为数据集合的历史快照，用于在某些特殊情况下恢复数据。比如不小心手动删除了数据库。(这时，哪些实时同步的从几点也会同时删除掉数据库，而延迟复制的从节点还没同步到这个操作，因此就有了一段时间可以人为的去恢复数据。)

+ Arbiter 仲裁者    

在某些情况下(比如成本问题不允许你用两个从节点),你可以选择一个从节点加一个仲裁者节点。仲裁者节点但是是不会持有数据而且也不能成为主节点。但是仲裁者可以在选举中进行投票。

3.6版本开始，仲裁者 priority 必须 设置为0、当你升级版本到3.6的时候，如果有仲裁者节点priority为1的，name3.6版本需要重新把priority配置为0.

```
重要
不要将仲裁者放在和主节点或者从节点相同的服务器上。
```
